- name: Ensure openscap/linuxsummary directory exists
  ansible.builtin.file:
    path: /var/www/html/openscap/linuxsummary
    state: directory
    owner: root
    group: root
    mode: '0755'
  delegate_to: 172.25.225.89
  run_once: true

- name: Template Summary Report
  ansible.builtin.template:
    src: "scan_reports.html.j2"
    dest: "/var/www/html/openscap/linuxsummary/index.html"
    owner: root
    group: root
    mode: '0644'
  delegate_to: 172.25.225.89
  run_once: true

- name: DISPLAY LINK TO SUMMARY REPORT
  ansible.builtin.debug:
    msg: "http://172.25.225.89/openscap/linuxsummary/index.html"
  run_once: true

- name: Template Summary Report for e-mail
  ansible.builtin.template:
    src: "scan_reports.html.j2"
    dest: "/tmp/linux{{ ansible_date_time.iso8601 }}.html"
    owner: root
    group: root
    mode: '0644'
  delegate_to: 172.25.225.89
  run_once: true
  when: sendemailreport

- name: Find all scap folders
  ansible.builtin.find:
    paths: /var/www/html/openscap
    file_type: directory
  delegate_to: 172.25.225.89
  run_once: true
  register: completedreports

- name: Create Scap Report Index Page
  ansible.builtin.template:
    src: "indexpage.html.j2"
    dest: "/var/www/html/openscap/index.html"
    owner: root
    group: root
    mode: '0644'
  delegate_to: 172.25.225.89
  run_once: true

- name: DISPLAY LINK TO SCAP INDEX PAGE
  ansible.builtin.debug:
    msg: "http://172.25.225.89/openscap/index.html"
  run_once: true
